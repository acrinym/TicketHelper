<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NextNote V4 Fixed - With Quill</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <link href="libs/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link id="redThemeStylesheet" rel="stylesheet" href="css.css" disabled>
</head>
<body>
  <div id="sidebar">
    <div style="margin-bottom:10px;">
      <select id="notebookSelect" onchange="switchNotebook(event)"></select>
      <button onclick="newNotebook()">+ Notebook</button>
    </div>
    <h3>Sections</h3>
    <input id="newSectionInput" placeholder="New Section Name"/>
    <button onclick="addSection()">+ Add Section</button>
    <hr/>
    <div id="sections"></div>
  </div>
  <div id="main">
    <div id="templateSelector" class="overlay">
        <div class="template-box">
            <h3>Choose a Template</h3>
            <div id="templateSelectorList"></div>
            <button onclick="document.getElementById('templateSelector').style.display='none'">Cancel</button>
        </div>
    </div>
    <div id="toolbar">
      <span id="currentPageName">No Page Selected</span>
      <span id="pageMeta" style="margin-left:10px;color:var(--hermes-disabled-text);"></span>
      <div class="notebook-select">
        <select id="notebookSelect" onchange="switchNotebook(this.value)"></select>
        <button onclick="createNotebook()">+Notebook</button>
      </div>
      <button onclick="saveCurrentPage()">üíæ Save</button>
      <button onclick="togglePreview()">üìÑ Preview</button>
      <button onclick="document.getElementById('imgInput').click()">üèûÔ∏è Image</button>
      <input type="file" id="imgInput" accept="image/*" style="display:none" onchange="insertImage(event)"/>
      <button onclick="exportMarkdown()">‚¨áÔ∏è Export MD</button>
      <button onclick="exportNotebook()">‚¨áÔ∏è Export All</button>
      <input type="file" id="importFile" style="display:none" onchange="importMarkdown(event)"/>
      <button onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Import MD</button>
      <input type="file" id="importNotebookFile" style="display:none" onchange="importNotebook(event)" accept=".json,.nextnote.json"/>
      <button onclick="document.getElementById('importNotebookFile').click()">‚¨ÜÔ∏è Import All</button>
      <input id="searchInput" placeholder="Search..." oninput="updateSearch()" style="margin-left:auto;">
      <button onclick="showSettingsPanel()">‚öôÔ∏è</button>
      <button onclick="toggleAttachments()">üìé Attachments</button>
      <button onclick="showHistory()">History</button>
      <button onclick="showTemplateManager()">Templates</button>
      <input type="file" id="attachmentInput" style="display:none" multiple onchange="addAttachments(event)"/>
      <div id="attachmentsPanel"></div>
      <div id="searchResults"></div>
    </div>
    <div id="editor">
      <div id="quillEditorContainer"></div>
      <div id="preview" style="display:none;"></div>
    </div>
  </div>
  <div id="commandPalette" class="overlay">
    <div class="palette-box">
      <input id="commandInput" placeholder="Jump to page..." />
      <div id="commandResults"></div>
    </div>
  </div>
  <div id="templateManager" class="overlay">
    <div class="template-box" style="width: 600px; display: flex; gap: 10px;">
        <div id="templateMaster" style="width: 200px; border-right: 1px solid var(--hermes-border); padding-right: 10px;">
            <h3>Templates</h3>
            <div id="templateList" style="cursor:pointer;"></div>
            <button id="newTemplateBtn">New Template</button>
        </div>
        <div id="templateDetail" style="flex: 1;">
            <input type="hidden" id="templateId" />
            <label>Name: <input type="text" id="templateNameInput" style="width: 95%;"></label>
            <br><br>
            <label>Content (Markdown): <textarea id="templateContentInput" style="width: 95%; height: 200px;"></textarea></label>
            <div style="margin-top:10px;">
                <button id="saveTemplateBtn">Save</button>
                <button id="deleteTemplateBtn">Delete</button>
                <button onclick="hideTemplateManager()">Close</button>
            </div>
        </div>
    </div>
  </div>
  <div id="historyPanel" class="overlay">
    <div class="template-box">
      <h3>History</h3>
      <div id="historyList"></div>
      <button onclick="hideHistory()">Close</button>
    </div>
  </div>
  <div id="settingsPanel" class="overlay">
    <div class="settings-box">
      <div id="settingsTabs">
        <button onclick="showSettingsSection('appearance')">Appearance</button>
        <button onclick="showSettingsSection('editor')">Editor</button>
        <button onclick="showSettingsSection('notebooks')">Notebooks</button>
        <button onclick="showSettingsSection('plugins')">Plugins</button>
        <button onclick="hideSettingsPanel()" style="margin-left:auto;">Close</button>
      </div>
      <div id="settingsContent">
        <div id="settings-appearance" class="settings-section">
          <h3>Appearance</h3>
          <label>Theme:
            <select id="themeSelect"></select>
          </label>
        </div>
        <div id="settings-editor" class="settings-section">
          <h3>Editor</h3>
          <label>Font Size:<input type="number" id="fontSizeInput" min="10" max="32" step="1"></label>
          <br>
          <label>Autosave (ms):<input type="number" id="autosaveInput" min="5000" step="1000"></label>
        </div>
        <div id="settings-notebooks" class="settings-section">
          <h3>Notebooks</h3>
          <p>Notebook preferences coming soon.</p>
        </div>
        <div id="settings-plugins" class="settings-section">
          <h3>Plugin Management</h3>
          <div id="pluginList">
            <!-- Plugin toggles will be dynamically added here -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="libs/marked.min.js"></script>
  <script src="libs/turndown.min.js"></script>
  <script src="libs/sortable.min.js"></script>
  <script src="libs/quill.js"></script>
  <script src="lib/fuse.js"></script>
  <script src="script.js"></script>
  <script src="plugins/plugin-loader.js"></script>
</body>
</html>